doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Report broken page
    script.
      async function solvePoWAndSubmit() {
          const data = document.getElementById('data').value;
          const timestamp = new Date().toISOString();
          let nonce = 0;
          let powHash = '';
          const targetPrefix = '0000'; 

          while (!powHash.startsWith(targetPrefix)) {
              const toHash = data + timestamp + nonce;
              powHash = await sha256(toHash);
              nonce++;
          }
          
          nonce = nonce -1

          const formData = new URLSearchParams();
          formData.append('data', data);
          formData.append('timestamp', timestamp);
          formData.append('nonce', nonce);
          formData.append('powHash', powHash);

          const response = await fetch('/sendreport', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/x-www-form-urlencoded',
              },
              body: formData.toString(),
          });

          if (response.ok) {
              const result = await response.json();
              console.log('Server response:', result);
              alert('Submission successful: ' + JSON.stringify(result));
          } else {
              const error = await response.json();
              console.error('Error:', error);
              alert('Submission failed: ' + error.error);
          }
      }

      async function sha256(message) {
          const msgBuffer = new TextEncoder().encode(message);
          const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
          return hashHex;
      }
  body
    h1 Report broken page:
    form(onsubmit="event.preventDefault(); solvePoWAndSubmit();")
      label(for="data") Page: /
      input(type="text" id="data" name="data" required)
      button(type="submit") Submit
